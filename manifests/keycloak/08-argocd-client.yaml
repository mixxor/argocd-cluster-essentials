---
# Example: ArgoCD OIDC Client with group-based access
# This client allows ArgoCD users to authenticate via Keycloak
# Only users in the moebiuscloud-members group will have access
apiVersion: v1.edp.epam.com/v1
kind: KeycloakClient
metadata:
  name: argocd
  namespace: keycloak
spec:
  realmRef:
    name: moebiuscloud
    kind: KeycloakRealm
  clientId: argocd
  name: ArgoCD
  enabled: true
  clientAuthenticatorType: client-secret
  protocol: openid-connect
  publicClient: false
  standardFlowEnabled: true
  directAccessGrantsEnabled: false
  serviceAccountsEnabled: false
  secret: argocd-client-secret
  webUrl: https://argocd.infomaniak.moebi.io
  redirectUris: [https://argocd.infomaniak.moebi.io/auth/callback]
  defaultClientScopes: [openid, profile, email, groups]
  protocolMappers:
    - name: groups
      protocol: openid-connect
      protocolMapper: oidc-group-membership-mapper
      config:
        full.path: 'false'
        id.token.claim: 'true'
        access.token.claim: 'true'
        claim.name: groups
        userinfo.token.claim: 'true'
