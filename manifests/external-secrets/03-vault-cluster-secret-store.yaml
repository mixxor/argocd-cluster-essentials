---
# ClusterSecretStore for Hashicorp Vault
# This connects External Secrets Operator to Vault using Kubernetes auth
#
# PREREQUISITE: Configure Vault Kubernetes auth method:
#   vault auth enable kubernetes
#   vault write auth/kubernetes/config \
#     kubernetes_host="https://kubernetes.default.svc:443"
#   vault write auth/kubernetes/role/external-secrets \
#     bound_service_account_names=vault-auth \
#     bound_service_account_namespaces=external-secrets \
#     policies=external-secrets \
#     ttl=1h
#   vault policy write external-secrets - <<EOF
#   path "kv/data/*" {
#     capabilities = ["read"]
#   }
#   EOF
apiVersion: external-secrets.io/v1beta1
kind: ClusterSecretStore
metadata:
  name: vault
spec:
  provider:
    vault:
      server: http://vault.vault.svc.cluster.local:8200
      path: kv
      version: v2
      auth:
        kubernetes:
          mountPath: kubernetes
          role: external-secrets
          serviceAccountRef:
            name: vault-auth
            namespace: external-secrets
